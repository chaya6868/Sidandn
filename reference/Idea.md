# 第三期：思路草稿（待整理）



# 第二期：思路草稿（正在使用）

## 业务思路

## 1. popup弹窗端

权限：小

操作业务：尽可能小，只发送命令即可

popup.html：

- 插件主页，各种功能的入口
- 点击各种按钮，执行按钮对应的 JS 函数
- 如需收集数据的，将打开新页面，请用户输入数据
- 如不需要搜集数据的，或者已经收集数据完毕，将发送请求数据到content_script端

## 2. content_script端

权限：大

操作业务：包含"其他页面的显示"、"数据库操作"、"操作目标dom元素"

1. 监听并获取请求
2. 分析对应的请求，执行对应功能
3. 其中，包括：数据库操作、显示页面、操作dom元素
4. 数据库里面的数据一旦被修改后，需要立即向popup页面发起刷新



## 3. data.json 端

数据库的设计：ExtensionData.json

```json
{
    "id": 1,
    name: "测试任务",
    time: "2024-9-17 23:28:16"
    operation: [
        {
            element: obj,
            input: "xxx"
        },
        {yyy},
        {yyy}
    ]
}
```

发送与返回的数据格式设计

从 popup 发送到 content_script 再发送到 background

发送到数据库

```json
{
	request: 'rename',
	status: 0
	payload: {
		id: 5,
		data: 'jack'
	}
}
```

响应回

```json
{
	request: 'rename',
	status: 1
	payload: {
		id: 5,
		data: null
	}
}
```



# 第一期：思路草稿（已抛弃）

## Sidandn 界面与功能实现流程

- 点击添加任务
- =============================
- 弹出任务信息框
- 输入内容，点击确定
- 将数据进行封装
- 执行写入文件函数，向 data.json 文件中写入一个任务对象
- 执行读取文件函数，从 data.json 文件中读取所有任务对象
- 渲染数据，并刷新Sidandn界面
- 关闭信息框
- =============================



## Sidandn 界面与功能实现流程

- 点击重命名
- ============
- 同上
- ============

## Sidandn 界面与功能实现流程

- 点击删除
- ============
- 同上
- ============

## Sidandn 界面与功能实现流程

- 点击启动，触发执行任务函数（发送run命令）



## Sidandn 操作框界面实现流程

- 定时输入框，选择时间
- 点击执行，触发执行任务函数（发送run命令）



## Sidandn 界面与功能实现流程

- 点击编辑
- 打开新页面，执行读取文件函数，从 data.json 文件中读取当前任务的操作信息，渲染到页面上
- 监听输入框的变化，执行写入文件函数，向 data.json 文件中写入一个任务对象





## Sidandn 界面与功能实现流程

- 循环开始

- 点击 `添加操作`，发送node命令






## 内容脚本实现流程x1

- 接受node命令
- 马上监控用户录入的节点
- 获取到节点
- 发送给 Sidandn 界面

## 内容脚本实现流程x2

- 接受run命令
- 执行run函数：
  - 第一步：解析 node 节点，定位到文档对应的对象
  - 第二部：根据输入框的内容，判断是否输入内容，还是单纯执行鼠标点击操作
  - 第三部：进行延时操作
  - 循环：执行任务的下一个操作



## Sidandn 界面与功能实现流程

- 接收到节点
- 用户配置其他信息，完成 `一项操作`
- 自动保存到 data.json 文件
- 循环结束

Json 文件

```json
{
	"taskNumber": 5,
    "task": [
        {},
        {},
        {}
    ]
}
任务总数量：box.taskNumber
第一个任务：box.task[0]
```

```
box.task[0] === {
	"name": "登录京东",
	"operation": [
		{},
		{},
		{}
	]
}
任务的名字：box.task[0].name
任务的第一个操作：box.task[0].operation[0]
```

```
box.task[0].operation[0] === {
	"node": "要被操作的节点",
	"click": true,
	"input": "null"
	"delay": 100
}

延时100毫秒
```

